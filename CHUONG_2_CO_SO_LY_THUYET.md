# CHƯƠNG 2: CƠ SỞ LÝ THUYẾT

## 2.1. Khái quát về thương mại điện tử

### 2.1.1. Khái niệm thương mại điện tử

Thương mại điện tử (E-commerce) là việc thực hiện các hoạt động mua bán, trao đổi hàng hóa và dịch vụ thông qua các phương tiện điện tử, đặc biệt là Internet. Theo định nghĩa của Tổ chức Hợp tác và Phát triển Kinh tế (OECD), thương mại điện tử bao gồm "việc mua bán hoặc trao đổi hàng hóa và dịch vụ giữa các doanh nghiệp, hộ gia đình, cá nhân, chính phủ và các tổ chức công cộng khác, được thực hiện qua các mạng máy tính dựa trên Internet" [1].

Trong bối cảnh hiện đại, thương mại điện tử không chỉ dừng lại ở việc mua bán trực tuyến mà còn bao gồm các hoạt động hỗ trợ như thanh toán điện tử, quản lý chuỗi cung ứng, tiếp thị số, và dịch vụ khách hàng trực tuyến.

### 2.1.2. Vai trò của thương mại điện tử

Thương mại điện tử đóng vai trò quan trọng trong nền kinh tế số hiện đại:

**Đối với người tiêu dùng:**
- Tiết kiệm thời gian và chi phí đi lại
- Tiếp cận đa dạng sản phẩm từ nhiều nguồn
- So sánh giá cả và đặc điểm sản phẩm dễ dàng
- Mua sắm mọi lúc, mọi nơi

**Đối với người bán:**
- Mở rộng thị trường không giới hạn địa lý
- Giảm chi phí vận hành (không cần mặt bằng, nhân viên bán hàng)
- Tự động hóa quy trình bán hàng
- Thu thập và phân tích dữ liệu khách hàng

**Đối với nền kinh tế:**
- Thúc đẩy tăng trưởng GDP
- Tạo việc làm mới trong lĩnh vực công nghệ và logistics
- Thúc đẩy đổi mới sáng tạo và chuyển đổi số

### 2.1.3. Các mô hình thương mại điện tử phổ biến

#### 2.1.3.1. Mô hình B2C (Business-to-Consumer)

B2C là mô hình giao dịch trực tiếp giữa doanh nghiệp và người tiêu dùng cuối cùng. Đây là mô hình phổ biến nhất trong thương mại điện tử, được thể hiện qua các sàn thương mại điện tử lớn như Amazon, Shopee, Lazada.

**Đặc điểm:**
- Doanh nghiệp bán hàng trực tiếp cho người tiêu dùng
- Quy mô lớn, khối lượng giao dịch cao
- Tập trung vào trải nghiệm người dùng và dịch vụ khách hàng
- Cần hệ thống logistics và thanh toán mạnh mẽ

**Ưu điểm:**
- Kiểm soát chất lượng sản phẩm và dịch vụ tốt
- Xây dựng thương hiệu mạnh
- Tối ưu hóa chuỗi cung ứng
- Quản lý giá cả và chính sách bán hàng linh hoạt

**Nhược điểm:**
- Vốn đầu tư ban đầu lớn
- Rủi ro tồn kho cao
- Cạnh tranh khốc liệt
- Yêu cầu nhân lực và công nghệ cao

#### 2.1.3.2. Mô hình C2C (Consumer-to-Consumer)

C2C là mô hình giao dịch giữa các cá nhân với nhau, thông qua một nền tảng trung gian. Các ví dụ điển hình bao gồm eBay, Facebook Marketplace, và các sàn đấu giá trực tuyến.

**Đặc điểm:**
- Người bán và người mua đều là cá nhân
- Nền tảng đóng vai trò trung gian, cung cấp không gian giao dịch
- Đa dạng về sản phẩm, từ hàng mới đến hàng đã qua sử dụng
- Giao dịch nhỏ lẻ, đa dạng về giá trị

**Ưu điểm:**
- Chi phí tham gia thấp cho người bán
- Đa dạng sản phẩm, đáp ứng nhu cầu đặc biệt
- Tận dụng tài sản cá nhân (hàng cũ, đồ không dùng đến)
- Tạo cơ hội kinh doanh cho cá nhân

**Nhược điểm:**
- Khó kiểm soát chất lượng sản phẩm
- Rủi ro gian lận cao
- Thiếu chính sách bảo hành và đổi trả chuẩn hóa
- Phụ thuộc vào uy tín cá nhân

---

## 2.2. Mô hình C2C mở rộng hướng B2C

### 2.2.1. Khái niệm và đặc điểm

Mô hình C2C mở rộng hướng B2C là một mô hình lai (hybrid model) kết hợp đặc điểm của cả hai mô hình truyền thống. Trong mô hình này, nền tảng cho phép cả cá nhân và doanh nghiệp tham gia bán hàng, nhưng có sự phân biệt về quyền lợi và tính năng dựa trên loại tài khoản.

**Đặc điểm chính:**

1. **Đa dạng người bán:** Hệ thống hỗ trợ cả tài khoản cá nhân và tài khoản doanh nghiệp, mỗi loại có các tính năng và quyền lợi riêng.

2. **Phân tầng dịch vụ:** Doanh nghiệp được cung cấp các tính năng nâng cao như livestream bán hàng, quản lý tồn kho, dashboard bán hàng chuyên nghiệp.

3. **Linh hoạt trong giao dịch:** Người mua có thể mua từ cả cá nhân và doanh nghiệp trên cùng một nền tảng.

4. **Hệ thống phí linh hoạt:** Áp dụng chính sách phí khác nhau cho từng loại tài khoản và tính năng sử dụng.

### 2.2.2. Ưu điểm của mô hình lai

**Đối với nền tảng:**
- Tăng nguồn thu từ nhiều kênh (phí đăng tin, phí gói livestream, hoa hồng giao dịch)
- Đa dạng hóa dịch vụ, tăng giá trị cho người dùng
- Tận dụng được cả hai thị trường: cá nhân và doanh nghiệp
- Tạo hệ sinh thái thương mại điện tử hoàn chỉnh

**Đối với người bán:**
- Cá nhân: Bắt đầu với chi phí thấp, có thể nâng cấp lên doanh nghiệp khi phát triển
- Doanh nghiệp: Tiếp cận công cụ chuyên nghiệp để mở rộng quy mô
- Linh hoạt chuyển đổi giữa các mô hình kinh doanh

**Đối với người mua:**
- Tiếp cận đa dạng sản phẩm từ nhiều nguồn
- Lựa chọn giữa hàng cá nhân (giá rẻ) và hàng doanh nghiệp (đảm bảo chất lượng)
- Trải nghiệm mua sắm phong phú với nhiều tính năng

### 2.2.3. Nhược điểm và thách thức

1. **Phức tạp trong quản lý:** Hệ thống cần quản lý nhiều loại tài khoản, chính sách và tính năng khác nhau.

2. **Yêu cầu công nghệ cao:** Cần xây dựng hệ thống linh hoạt, có thể mở rộng và phân quyền phức tạp.

3. **Cân bằng lợi ích:** Cần đảm bảo công bằng giữa cá nhân và doanh nghiệp, tránh tạo rào cản cho người bán nhỏ.

4. **Kiểm soát chất lượng:** Khó khăn trong việc đảm bảo chất lượng đồng đều khi có nhiều loại người bán.

### 2.2.4. Lý do kết hợp hai mô hình

**1. Xu hướng thị trường:**
- Nhiều cá nhân bán hàng phát triển thành doanh nghiệp nhỏ
- Doanh nghiệp muốn tiếp cận thị trường C2C để tăng doanh số
- Người tiêu dùng có nhu cầu đa dạng, từ hàng giá rẻ đến hàng cao cấp

**2. Tối ưu hóa nguồn lực:**
- Tận dụng cơ sở hạ tầng sẵn có cho cả hai mô hình
- Chia sẻ hệ thống thanh toán, logistics, và dịch vụ khách hàng
- Giảm chi phí vận hành thông qua quy mô

**3. Tăng tính cạnh tranh:**
- Tạo hệ sinh thái đầy đủ, cạnh tranh với các nền tảng lớn
- Đa dạng hóa nguồn thu, giảm phụ thuộc vào một mô hình
- Tăng giá trị cho người dùng, tăng khả năng giữ chân khách hàng

**4. Đáp ứng nhu cầu thực tế:**
- Nhiều người bán bắt đầu với quy mô nhỏ (C2C) và phát triển lên quy mô lớn (B2C)
- Mô hình lai cho phép chuyển đổi linh hoạt mà không cần thay đổi nền tảng

### 2.2.5. Ứng dụng trong hệ thống "Chợ Việt"

Trong hệ thống "Chợ Việt", mô hình C2C mở rộng hướng B2C được thể hiện qua:

**Phân loại tài khoản:**
- Tài khoản cá nhân: Đăng tin bán hàng cơ bản, tối đa 3 tin miễn phí
- Tài khoản doanh nghiệp: Có quyền sử dụng livestream, quản lý tồn kho, dashboard bán hàng

**Tính năng phân tầng:**
- Cá nhân: Đăng tin, chat, đánh giá
- Doanh nghiệp: Tất cả tính năng cá nhân + livestream, quản lý đơn hàng, thống kê doanh thu

**Chính sách phí:**
- Cá nhân: Miễn phí 3 tin đầu, từ tin thứ 4 trở đi: 11.000đ/tin
- Doanh nghiệp: Mua gói livestream (theo tháng/năm) để sử dụng tính năng livestream

---

## 2.3. Livestream trong thương mại điện tử

### 2.3.1. Khái niệm và xu hướng

Livestream bán hàng (Live Commerce) là hình thức bán hàng trực tuyến thông qua việc phát sóng trực tiếp video, cho phép người bán tương tác trực tiếp với người xem và bán sản phẩm trong thời gian thực. Đây là một trong những xu hướng phát triển mạnh mẽ nhất trong thương mại điện tử hiện đại.

Theo báo cáo của Statista, thị trường livestream commerce toàn cầu dự kiến đạt 247 tỷ USD vào năm 2023, tăng trưởng 20% so với năm 2022 [2]. Tại Việt Nam, livestream bán hàng đã trở thành kênh bán hàng chính của nhiều doanh nghiệp, đặc biệt trong các lĩnh vực thời trang, mỹ phẩm, và điện tử.

### 2.3.2. Đặc điểm của livestream bán hàng

**1. Tương tác trực tiếp:**
- Người bán và người mua tương tác trong thời gian thực
- Trả lời câu hỏi ngay lập tức
- Tạo cảm giác gần gũi, tin cậy

**2. Trải nghiệm đa giác quan:**
- Người mua có thể xem sản phẩm từ nhiều góc độ
- Nghe giải thích chi tiết về sản phẩm
- Cảm nhận được sự nhiệt tình của người bán

**3. Tính cấp bách:**
- Giới hạn thời gian, tạo cảm giác khan hiếm
- Khuyến mãi đặc biệt chỉ trong livestream
- Thúc đẩy quyết định mua hàng nhanh chóng

**4. Tính giải trí:**
- Kết hợp bán hàng với giải trí
- Tạo nội dung hấp dẫn, thu hút người xem
- Xây dựng cộng đồng người theo dõi

### 2.3.3. Hiệu quả tiếp cận khách hàng

**1. Tăng tỷ lệ chuyển đổi:**
- Tỷ lệ chuyển đổi của livestream cao hơn 10-30 lần so với hình thức bán hàng truyền thống trực tuyến
- Người xem có thể đặt hàng ngay trong livestream, giảm thời gian suy nghĩ

**2. Mở rộng phạm vi tiếp cận:**
- Không giới hạn địa lý
- Có thể tiếp cận hàng nghìn, thậm chí hàng triệu người xem cùng lúc
- Tận dụng thuật toán của các nền tảng để tiếp cận đúng đối tượng

**3. Xây dựng niềm tin:**
- Người bán xuất hiện trực tiếp, tạo cảm giác tin cậy
- Trả lời câu hỏi minh bạch, rõ ràng
- Người xem có thể thấy phản hồi của người mua khác trong thời gian thực

**4. Tối ưu hóa chi phí marketing:**
- Một livestream có thể thay thế nhiều quảng cáo
- Tương tác tự nhiên, không tốn chi phí quảng cáo cho mỗi lượt tương tác
- Tận dụng người xem để lan truyền thông tin

### 2.3.4. Công nghệ hỗ trợ livestream

**1. Streaming Protocol:**
- RTMP (Real-Time Messaging Protocol): Giao thức phổ biến cho livestream
- HLS (HTTP Live Streaming): Phù hợp cho phát sóng qua web
- WebRTC: Cho phép tương tác real-time với độ trễ thấp

**2. CDN (Content Delivery Network):**
- Phân phối nội dung đến người xem gần nhất
- Giảm độ trễ, tăng chất lượng phát sóng
- Hỗ trợ số lượng người xem lớn

**3. Tích hợp thanh toán:**
- Thanh toán trực tiếp trong livestream
- Giỏ hàng real-time
- Thông báo đơn hàng ngay lập tức

**4. Phân tích dữ liệu:**
- Theo dõi số lượng người xem
- Phân tích hành vi người xem
- Tối ưu hóa thời gian và nội dung livestream

### 2.3.5. Ứng dụng trong hệ thống "Chợ Việt"

Trong hệ thống "Chợ Việt", tính năng livestream được thiết kế dành riêng cho tài khoản doanh nghiệp, thể hiện qua:

**Quản lý livestream:**
- Tạo livestream với thông tin: tiêu đề, mô tả, thời gian bắt đầu/kết thúc
- Upload ảnh đại diện cho livestream
- Quản lý trạng thái: chưa bắt đầu, đang phát sóng, đã kết thúc

**Quản lý sản phẩm trong livestream:**
- Thêm sản phẩm vào livestream với giá đặc biệt
- Ghim sản phẩm nổi bật
- Quản lý số lượng tồn kho cho từng sản phẩm trong livestream

**Theo dõi và thống kê:**
- Số lượng người xem hiện tại
- Số lượng sản phẩm trong livestream
- Lịch sử livestream đã tạo

**Gói livestream:**
- Doanh nghiệp cần mua gói livestream (theo tháng/năm) để sử dụng tính năng
- Thanh toán qua ví hoặc VNPay
- Quản lý lịch sử mua gói

---

## 2.4. Cơ chế nhắn tin, đánh giá và kiểm duyệt

### 2.4.1. Hệ thống nhắn tin trực tiếp

#### 2.4.1.1. Vai trò của nhắn tin trong thương mại điện tử

Nhắn tin trực tiếp (Direct Messaging) là một thành phần quan trọng trong trải nghiệm mua sắm trực tuyến, đóng vai trò cầu nối giữa người mua và người bán. Khác với mua sắm truyền thống nơi người mua có thể trực tiếp xem và hỏi về sản phẩm, trong môi trường trực tuyến, nhắn tin là phương tiện chính để:

**1. Trao đổi thông tin:**
- Người mua có thể hỏi về chi tiết sản phẩm, kích thước, màu sắc, tình trạng
- Người bán cung cấp thông tin bổ sung, hình ảnh, video
- Thỏa thuận về giá cả, phương thức thanh toán, vận chuyển

**2. Xây dựng niềm tin:**
- Tương tác trực tiếp tạo cảm giác tin cậy
- Phản hồi nhanh chóng thể hiện sự chuyên nghiệp
- Giải quyết thắc mắc kịp thời, tăng sự hài lòng

**3. Hỗ trợ quyết định mua hàng:**
- Trả lời câu hỏi giúp người mua đưa ra quyết định
- Cung cấp thông tin không có trong mô tả sản phẩm
- Tư vấn sản phẩm phù hợp với nhu cầu

**4. Chăm sóc khách hàng sau bán:**
- Hỗ trợ vấn đề sau khi mua hàng
- Xử lý khiếu nại, đổi trả
- Duy trì mối quan hệ với khách hàng

#### 2.4.1.2. Kiến trúc hệ thống nhắn tin real-time

Hệ thống nhắn tin trong "Chợ Việt" sử dụng kiến trúc kết hợp giữa WebSocket và REST API:

**1. WebSocket Server (Node.js):**
- Xử lý tin nhắn real-time giữa các client
- Broadcast tin nhắn đến người nhận khi họ đang online
- Quản lý kết nối và trạng thái người dùng

**2. REST API (PHP):**
- Lưu trữ tin nhắn vào database
- Lấy lịch sử tin nhắn
- Xử lý file đính kèm, hình ảnh sản phẩm

**3. Database:**
- Lưu trữ tin nhắn với các trường: sender_id, receiver_id, content, product_id, created_time
- Đảm bảo tính nhất quán dữ liệu
- Hỗ trợ truy vấn lịch sử tin nhắn

**4. File Storage:**
- Lưu trữ tin nhắn dạng JSON cho mỗi cặp người dùng
- Hỗ trợ đồng bộ giữa WebSocket và database
- Backup dữ liệu tin nhắn

#### 2.4.1.3. Tính năng nhắn tin trong hệ thống

**Gửi và nhận tin nhắn:**
- Gửi tin nhắn text giữa người mua và người bán
- Gửi kèm link sản phẩm (product_id) để tham chiếu
- Hiển thị thời gian gửi tin nhắn

**Danh sách cuộc trò chuyện:**
- Hiển thị danh sách người đã nhắn tin
- Hiển thị tin nhắn cuối cùng và thời gian
- Sắp xếp theo thời gian tin nhắn mới nhất

**Trạng thái đã đọc/chưa đọc:**
- Đánh dấu tin nhắn đã đọc
- Thông báo số tin nhắn chưa đọc
- Cập nhật real-time khi có tin nhắn mới

### 2.4.2. Hệ thống đánh giá người bán

#### 2.4.2.1. Vai trò của đánh giá trong thương mại điện tử

Hệ thống đánh giá (Review/Rating System) là một trong những yếu tố quan trọng nhất trong việc xây dựng niềm tin và quyết định mua hàng của người tiêu dùng. Theo nghiên cứu của BrightLocal, 88% người tiêu dùng tin tưởng đánh giá trực tuyến như tin tưởng lời khuyên từ bạn bè [3].

**Vai trò đối với người mua:**
- Cung cấp thông tin thực tế về sản phẩm và người bán
- Giúp đưa ra quyết định mua hàng dựa trên trải nghiệm của người khác
- Tránh rủi ro mua phải hàng kém chất lượng hoặc người bán không uy tín

**Vai trò đối với người bán:**
- Xây dựng uy tín và thương hiệu
- Cải thiện chất lượng dịch vụ dựa trên phản hồi
- Tăng tỷ lệ chuyển đổi nhờ đánh giá tích cực

**Vai trò đối với nền tảng:**
- Đảm bảo chất lượng người bán trên nền tảng
- Tạo môi trường minh bạch, công bằng
- Tăng niềm tin của người dùng vào nền tảng

#### 2.4.2.2. Mô hình đánh giá trong hệ thống

Trong hệ thống "Chợ Việt", đánh giá được thực hiện sau khi hoàn thành giao dịch:

**Cấu trúc đánh giá:**
- **reviewer_id:** ID người đánh giá (người mua)
- **reviewed_user_id:** ID người được đánh giá (người bán)
- **product_id:** ID sản phẩm liên quan đến giao dịch
- **rating:** Điểm đánh giá (thường từ 1-5 sao)
- **comment:** Nhận xét chi tiết

**Quy tắc đánh giá:**
- Mỗi người mua chỉ có thể đánh giá một lần cho mỗi sản phẩm của một người bán
- Đánh giá được gắn với sản phẩm cụ thể, không phải chung chung
- Người bán có thể xem tất cả đánh giá về mình

**Hiển thị đánh giá:**
- Hiển thị điểm trung bình của người bán
- Danh sách đánh giá chi tiết với comment
- Sắp xếp theo thời gian (mới nhất trước)

### 2.4.3. Hệ thống kiểm duyệt bài đăng

#### 2.4.3.1. Vai trò của kiểm duyệt

Kiểm duyệt bài đăng (Content Moderation) là quá trình xem xét và phê duyệt nội dung trước khi được công khai trên nền tảng. Đây là một thành phần quan trọng để:

**1. Đảm bảo chất lượng nội dung:**
- Loại bỏ bài đăng spam, lừa đảo
- Đảm bảo thông tin sản phẩm chính xác
- Tuân thủ các quy định pháp luật

**2. Bảo vệ người tiêu dùng:**
- Ngăn chặn hàng giả, hàng nhái
- Đảm bảo mô tả sản phẩm trung thực
- Bảo vệ thông tin cá nhân

**3. Duy trì môi trường lành mạnh:**
- Loại bỏ nội dung không phù hợp
- Đảm bảo giao dịch công bằng
- Xây dựng cộng đồng tích cực

#### 2.4.3.2. Quy trình kiểm duyệt trong hệ thống

Trong hệ thống "Chợ Việt", quy trình kiểm duyệt được thực hiện như sau:

**1. Trạng thái bài đăng:**
- **Chờ duyệt:** Bài đăng mới được tạo, chưa được phê duyệt
- **Đã duyệt:** Bài đăng đã được phê duyệt, hiển thị công khai
- **Từ chối:** Bài đăng không đạt yêu cầu, bị từ chối

**2. Quy trình kiểm duyệt:**
```
Người bán đăng tin → Hệ thống lưu với status = "Chờ duyệt" 
→ Admin xem xét → Phê duyệt/Từ chối → Cập nhật status
```

**3. Tiêu chí kiểm duyệt:**
- Thông tin sản phẩm đầy đủ (tiêu đề, mô tả, giá, hình ảnh)
- Hình ảnh rõ ràng, chất lượng tốt (tối thiểu 2 ảnh)
- Giá cả hợp lý, không có dấu hiệu lừa đảo
- Nội dung không vi phạm pháp luật, đạo đức

**4. Tự động hóa một phần:**
- Kiểm tra thông tin bắt buộc (tiêu đề, giá, hình ảnh)
- Validate định dạng file ảnh
- Kiểm tra số dư tài khoản (nếu cần phí đăng tin)
- Rate limiting: Giới hạn số bài đăng trong khoảng thời gian

**5. Xử lý sau kiểm duyệt:**
- Thông báo cho người bán khi bài đăng được duyệt/từ chối
- Gửi email thông báo (nếu có)
- Cập nhật trạng thái hiển thị trên website

---

## 2.5. Chính sách phí và duy trì hệ thống

### 2.5.1. Mô hình thu phí bài đăng

#### 2.5.1.1. Nguyên tắc thu phí

Hệ thống "Chợ Việt" áp dụng mô hình thu phí linh hoạt cho việc đăng tin bán hàng, nhằm cân bằng giữa việc tạo cơ hội cho người bán nhỏ và duy trì chất lượng nội dung trên nền tảng.

**Chính sách miễn phí:**
- Mỗi tài khoản được miễn phí 3 bài đăng đầu tiên
- Khuyến khích người dùng thử nghiệm nền tảng
- Tạo cơ hội cho người bán mới bắt đầu

**Chính sách thu phí:**
- Từ bài đăng thứ 4 trở đi: 11.000 VNĐ/bài đăng
- Phí được trừ trực tiếp từ số dư ví trong tài khoản
- Đảm bảo người bán có cam kết với bài đăng của mình

#### 2.5.1.2. Quy trình xử lý phí đăng tin

**1. Kiểm tra số lượng bài đăng:**
```php
// Kiểm tra số lượng tin đã đăng
$soLuong = $model->demSoLuongTin($idNguoiDang);
if ($soLuong >= 3) {
    // Cần trả phí
}
```

**2. Kiểm tra số dư:**
- Kiểm tra số dư tài khoản có đủ 11.000 VNĐ không
- Nếu không đủ, yêu cầu nạp tiền vào ví

**3. Trừ phí:**
- Trừ phí từ số dư ví khi bài đăng được tạo
- Cập nhật lịch sử giao dịch
- Gửi thông báo cho người dùng

**4. Lợi ích:**
- Giảm spam, tăng chất lượng bài đăng
- Tạo nguồn thu cho nền tảng
- Đảm bảo người bán có trách nhiệm với nội dung

### 2.5.2. Mô hình gói livestream

#### 2.5.2.1. Khái niệm và mục đích

Gói livestream là dịch vụ trả phí cho phép tài khoản doanh nghiệp sử dụng tính năng livestream bán hàng. Đây là một mô hình thu phí định kỳ (subscription model) nhằm:

**1. Phân biệt dịch vụ:**
- Tài khoản cá nhân: Chỉ đăng tin thông thường
- Tài khoản doanh nghiệp: Có thể sử dụng livestream (sau khi mua gói)

**2. Tạo nguồn thu ổn định:**
- Thu phí định kỳ (theo tháng/năm)
- Dự đoán được doanh thu
- Đầu tư phát triển tính năng livestream

**3. Đảm bảo chất lượng:**
- Chỉ doanh nghiệp nghiêm túc mới đầu tư vào livestream
- Giảm lạm dụng tính năng
- Tối ưu tài nguyên server

#### 2.5.2.2. Cấu trúc gói livestream

**Loại gói:**
- Gói theo tháng: Sử dụng livestream trong 30 ngày
- Gói theo năm: Sử dụng livestream trong 365 ngày (thường có ưu đãi)

**Tính năng gói:**
- Tạo livestream không giới hạn
- Quản lý sản phẩm trong livestream
- Thống kê và phân tích livestream
- Hỗ trợ kỹ thuật ưu tiên

**Quy trình mua gói:**
1. Người dùng chọn gói phù hợp
2. Thanh toán qua ví hoặc VNPay
3. Kích hoạt gói sau khi thanh toán thành công
4. Bắt đầu sử dụng tính năng livestream

#### 2.5.2.3. Phương thức thanh toán

**1. Thanh toán qua ví:**
- Trừ trực tiếp từ số dư ví trong tài khoản
- Xử lý ngay lập tức
- Không cần chuyển hướng

**2. Thanh toán qua VNPay:**
- Tích hợp cổng thanh toán VNPay
- Hỗ trợ thẻ ngân hàng, ví điện tử
- An toàn, bảo mật cao

**3. Xử lý sau thanh toán:**
- Cập nhật trạng thái tài khoản (nâng cấp lên doanh nghiệp nếu chưa)
- Kích hoạt quyền sử dụng livestream
- Gửi email xác nhận
- Lưu lịch sử giao dịch

### 2.5.3. Duy trì và phát triển hệ thống

#### 2.5.3.1. Chi phí vận hành

**1. Hạ tầng công nghệ:**
- Server hosting (web server, database server)
- CDN cho livestream và hình ảnh
- WebSocket server cho chat real-time
- Backup và disaster recovery

**2. Bảo trì và phát triển:**
- Cập nhật bảo mật
- Sửa lỗi và tối ưu hiệu năng
- Phát triển tính năng mới
- Hỗ trợ kỹ thuật

**3. Marketing và vận hành:**
- Quảng cáo thu hút người dùng
- Quản lý nội dung và kiểm duyệt
- Chăm sóc khách hàng
- Pháp lý và tuân thủ

#### 2.5.3.2. Nguồn thu

**1. Phí đăng tin:**
- Thu từ bài đăng thứ 4 trở đi
- Nguồn thu chính cho người bán cá nhân

**2. Gói livestream:**
- Thu phí định kỳ từ doanh nghiệp
- Nguồn thu ổn định, dự đoán được

**3. Hoa hồng giao dịch (tiềm năng):**
- Thu phần trăm từ mỗi giao dịch thành công
- Nguồn thu lớn khi quy mô phát triển

**4. Quảng cáo (tiềm năng):**
- Banner quảng cáo trên website
- Quảng cáo trong livestream
- Sponsored listings

#### 2.5.3.3. Mô hình bền vững

**1. Cân bằng chi phí - thu nhập:**
- Đảm bảo nguồn thu đủ để duy trì hệ thống
- Tối ưu chi phí vận hành
- Mở rộng quy mô hiệu quả

**2. Giá trị cho người dùng:**
- Cung cấp dịch vụ chất lượng
- Liên tục cải thiện trải nghiệm
- Đáp ứng nhu cầu thực tế

**3. Phát triển dài hạn:**
- Đầu tư vào công nghệ mới
- Mở rộng tính năng
- Xây dựng cộng đồng người dùng

---

## 2.6. Mô hình MVC trong phát triển web

### 2.6.1. Nguyên lý MVC

#### 2.6.1.1. Khái niệm

MVC (Model-View-Controller) là một mô hình kiến trúc phần mềm được sử dụng rộng rãi trong phát triển ứng dụng web. Mô hình này tách biệt logic ứng dụng thành ba thành phần chính:

**Model (Mô hình):**
- Đại diện cho dữ liệu và logic nghiệp vụ
- Tương tác trực tiếp với database
- Xử lý các thao tác CRUD (Create, Read, Update, Delete)
- Không phụ thuộc vào giao diện người dùng

**View (Giao diện):**
- Đại diện cho phần hiển thị dữ liệu cho người dùng
- Nhận dữ liệu từ Controller và hiển thị
- Không chứa logic nghiệp vụ phức tạp
- Có thể là HTML, JSON, XML tùy theo yêu cầu

**Controller (Điều khiển):**
- Điều phối giữa Model và View
- Xử lý input từ người dùng
- Gọi Model để lấy/xử lý dữ liệu
- Truyền dữ liệu đến View để hiển thị

#### 2.6.1.2. Luồng hoạt động

```
User Request → Controller → Model → Database
                                    ↓
User Response ← View ← Controller ← Model
```

**Ví dụ cụ thể:**
1. Người dùng yêu cầu xem danh sách sản phẩm
2. Controller nhận request, gọi Model
3. Model truy vấn database, trả về dữ liệu
4. Controller nhận dữ liệu, truyền cho View
5. View hiển thị danh sách sản phẩm cho người dùng

#### 2.6.1.3. Ưu điểm của MVC

**1. Separation of Concerns (Tách biệt mối quan tâm):**
- Mỗi thành phần có trách nhiệm riêng biệt
- Dễ bảo trì và mở rộng
- Giảm sự phụ thuộc giữa các thành phần

**2. Khả năng tái sử dụng:**
- Model có thể được sử dụng bởi nhiều Controller
- View có thể được tái sử dụng với dữ liệu khác
- Controller có thể xử lý nhiều loại request

**3. Dễ test:**
- Có thể test từng thành phần độc lập
- Mock Model để test Controller
- Test View với dữ liệu giả

**4. Hợp tác nhóm:**
- Frontend developer làm việc với View
- Backend developer làm việc với Model và Controller
- Giảm xung đột code

**5. Bảo trì dễ dàng:**
- Thay đổi giao diện không ảnh hưởng logic
- Thay đổi database không ảnh hưởng giao diện
- Dễ tìm và sửa lỗi

### 2.6.2. Ứng dụng MVC trong PHP

#### 2.6.2.1. Cấu trúc thư mục

Trong hệ thống "Chợ Việt", cấu trúc MVC được tổ chức như sau:

```
project/
├── model/          # Model layer
│   ├── mConnect.php
│   ├── mProduct.php
│   ├── mCategory.php
│   └── ...
├── view/           # View layer
│   ├── index.php
│   ├── header.php
│   ├── footer.php
│   └── ...
├── controller/     # Controller layer
│   ├── cProduct.php
│   ├── cCategory.php
│   ├── cPost.php
│   └── ...
└── index.php       # Entry point
```

#### 2.6.2.2. Ví dụ thực tế trong hệ thống

**Model (mProduct.php):**
```php
class mProduct {
    private $conn;
    
    public function __construct() {
        $p = new Connect();
        $this->conn = $p->connect();
    }
    
    public function getSanPhamMoiNhat($limit = 100) {
        $sql = "SELECT sp.*, nd.username, nd.avatar
                FROM products sp 
                JOIN users nd ON sp.user_id = nd.id 
                WHERE sp.sale_status = 'Đang bán' 
                AND sp.status = 'Đã duyệt'
                ORDER BY sp.updated_date DESC
                LIMIT ?";
        $stmt = $this->conn->prepare($sql);
        $stmt->bind_param("i", $limit);
        $stmt->execute();
        return $stmt->get_result();
    }
}
```

**Controller (cProduct.php):**
```php
class cProduct {
    public function getSanPhamMoi() {
        $m = new mProduct();
        return $m->getSanPhamMoiNhat(100);
    }
}
```

**View (index.php):**
```php
<?php
$controller = new cProduct();
$products = $controller->getSanPhamMoi();
?>
<!-- Hiển thị danh sách sản phẩm -->
<?php foreach ($products as $product): ?>
    <div class="product">
        <img src="<?= $product['image'] ?>">
        <h3><?= $product['title'] ?></h3>
        <p><?= $product['price'] ?> VNĐ</p>
    </div>
<?php endforeach; ?>
```

#### 2.6.2.3. Routing trong MVC

Trong hệ thống "Chợ Việt", routing được xử lý trong `index.php` thông qua các tham số `$_GET`:

```php
if (isset($_GET['detail']) && isset($_GET['id'])) {
    $id = $_GET['id'];
    $controller = new cDetailProduct();
    $controller->showDetail($id);
} else if (isset($_GET['category'])) {
    include_once("view/category.php");
} else if (isset($_GET['search'])) {
    include_once("view/search.php");
} else {
    include_once("view/index.php");
}
```

**Ưu điểm:**
- Đơn giản, dễ hiểu
- Không cần cấu hình phức tạp
- Phù hợp với quy mô vừa và nhỏ

**Nhược điểm:**
- File routing có thể trở nên lớn và phức tạp
- Khó quản lý khi có nhiều route
- Thiếu middleware và advanced features

#### 2.6.2.4. Best Practices trong MVC

**1. Model:**
- Chỉ chứa logic truy vấn database
- Sử dụng prepared statements để tránh SQL injection
- Trả về dữ liệu dạng array hoặc object
- Không chứa logic hiển thị

**2. Controller:**
- Xử lý input validation
- Gọi Model để lấy dữ liệu
- Xử lý logic nghiệp vụ
- Truyền dữ liệu đến View
- Không chứa HTML

**3. View:**
- Chỉ hiển thị dữ liệu
- Có thể có logic hiển thị đơn giản (vòng lặp, điều kiện)
- Không truy vấn database trực tiếp
- Tách biệt với logic nghiệp vụ

---

## 2.7. Công nghệ và công cụ sử dụng

### 2.7.1. PHP (Hypertext Preprocessor)

#### 2.7.1.1. Giới thiệu

PHP là ngôn ngữ lập trình server-side mã nguồn mở, được thiết kế đặc biệt cho phát triển web. PHP được sử dụng rộng rãi trong phát triển ứng dụng web động, đặc biệt là các hệ thống thương mại điện tử.

**Đặc điểm:**
- Mã nguồn mở, miễn phí
- Dễ học và sử dụng
- Hỗ trợ nhiều database (MySQL, PostgreSQL, MongoDB)
- Tích hợp tốt với HTML
- Cộng đồng lớn, tài liệu phong phú

#### 2.7.1.2. Ứng dụng trong hệ thống

Trong hệ thống "Chợ Việt", PHP được sử dụng cho:

**1. Backend Logic:**
- Xử lý request từ client
- Tương tác với database
- Xử lý business logic
- API endpoints

**2. Security:**
- CSRF protection
- XSS prevention
- Input validation
- Session management

**3. File Processing:**
- Upload và xử lý hình ảnh
- Generate safe filenames
- Validate file types

**Ví dụ trong hệ thống:**
```php
// Security helper
class Security {
    public static function validateCSRFToken($token) {
        if (!isset($_SESSION['csrf_token']) || empty($token)) {
            return false;
        }
        return hash_equals($_SESSION['csrf_token'], $token);
    }
    
    public static function sanitize($data) {
        return htmlspecialchars($data, ENT_QUOTES | ENT_HTML5, 'UTF-8');
    }
}
```

### 2.7.2. MySQL Database

#### 2.7.2.1. Giới thiệu

MySQL là hệ quản trị cơ sở dữ liệu quan hệ (RDBMS) mã nguồn mở, được sử dụng rộng rãi trong các ứng dụng web. MySQL nổi tiếng với hiệu suất cao, độ tin cậy và dễ sử dụng.

**Đặc điểm:**
- Mã nguồn mở, miễn phí
- Hiệu suất cao, xử lý được lượng dữ liệu lớn
- Hỗ trợ ACID transactions
- Bảo mật tốt với user permissions
- Tích hợp tốt với PHP

#### 2.7.2.2. Cấu trúc database trong hệ thống

Hệ thống "Chợ Việt" sử dụng MySQL để lưu trữ:

**Bảng chính:**
- `users`: Thông tin người dùng
- `products`: Thông tin sản phẩm
- `product_categories`: Danh mục sản phẩm
- `messages`: Tin nhắn giữa người dùng
- `reviews`: Đánh giá người bán
- `livestream`: Thông tin livestream
- `livestream_products`: Sản phẩm trong livestream
- `orders`: Đơn hàng
- `transactions`: Giao dịch thanh toán

**Kết nối database:**
```php
class Connect {
    public function connect() {
        $config = require __DIR__ . '/../config/env.php';
        $db = $config['database'];
        
        $con = mysqli_connect(
            $db['host'], 
            $db['username'], 
            $db['password'], 
            $db['database']
        );
        
        mysqli_query($con, "SET NAMES 'utf8mb4'");
        return $con;
    }
}
```

**Prepared Statements:**
```php
$sql = "SELECT * FROM products WHERE id = ?";
$stmt = $conn->prepare($sql);
$stmt->bind_param("i", $id);
$stmt->execute();
$result = $stmt->get_result();
```

### 2.7.3. HTML/CSS/JavaScript

#### 2.7.3.1. HTML (HyperText Markup Language)

HTML là ngôn ngữ đánh dấu tiêu chuẩn để tạo cấu trúc nội dung web. Trong hệ thống, HTML được sử dụng để:

- Tạo cấu trúc trang web
- Định nghĩa các thành phần giao diện
- Tích hợp với PHP để hiển thị dữ liệu động

#### 2.7.3.2. CSS (Cascading Style Sheets)

CSS được sử dụng để:
- Styling và layout trang web
- Responsive design cho mobile
- Tạo giao diện đẹp mắt, hiện đại

**Framework sử dụng:**
- Bootstrap 5: Framework CSS phổ biến
- Custom CSS: Styling riêng cho hệ thống

#### 2.7.3.3. JavaScript

JavaScript được sử dụng cho:
- Xử lý tương tác người dùng
- AJAX requests
- Real-time updates
- Form validation
- Dynamic content loading

**Ví dụ AJAX trong hệ thống:**
```javascript
// Gửi tin nhắn qua AJAX
fetch('api/chat-api.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        from: userId,
        to: receiverId,
        content: message
    })
})
.then(response => response.json())
.then(data => {
    // Xử lý response
});
```

### 2.7.4. AJAX (Asynchronous JavaScript and XML)

#### 2.7.4.1. Khái niệm

AJAX là kỹ thuật cho phép ứng dụng web gửi và nhận dữ liệu từ server mà không cần reload lại trang. Điều này tạo ra trải nghiệm người dùng mượt mà, tương tác cao.

#### 2.7.4.2. Ứng dụng trong hệ thống

**1. Chat real-time:**
- Gửi/nhận tin nhắn không cần reload
- Cập nhật danh sách tin nhắn tự động
- Hiển thị trạng thái đã đọc/chưa đọc

**2. Tìm kiếm:**
- Tìm kiếm sản phẩm không cần reload
- Gợi ý tìm kiếm khi gõ
- Filter sản phẩm động

**3. Form submission:**
- Đăng tin không cần reload
- Hiển thị thông báo real-time
- Validate form trước khi submit

**4. Livestream:**
- Cập nhật số lượng người xem
- Thêm sản phẩm vào livestream
- Cập nhật trạng thái livestream

### 2.7.5. WebSocket

#### 2.7.5.1. Khái niệm

WebSocket là giao thức truyền thông hai chiều (full-duplex) cho phép client và server giao tiếp real-time mà không cần HTTP request/response cycle. WebSocket đặc biệt hữu ích cho các ứng dụng cần cập nhật real-time như chat, livestream, notification.

**So sánh với HTTP:**
- HTTP: Request → Response, một chiều, có overhead
- WebSocket: Persistent connection, hai chiều, ít overhead

#### 2.7.5.2. Ứng dụng trong hệ thống

Trong hệ thống "Chợ Việt", WebSocket được sử dụng cho:

**1. Chat real-time:**
```javascript
// Node.js WebSocket Server
const wss = new WebSocket.Server({ port: 3000 });

wss.on('connection', function connection(ws) {
    ws.on('message', function incoming(message) {
        const data = JSON.parse(message);
        
        if (data.type === 'message') {
            // Broadcast tin nhắn đến người nhận
            if (clients[data.to]) {
                clients[data.to].send(JSON.stringify({
                    type: 'message',
                    from: data.from,
                    content: data.content
                }));
            }
        }
    });
});
```

**2. Livestream:**
- Cập nhật số lượng người xem real-time
- Broadcast tin nhắn trong livestream
- Cập nhật sản phẩm đang được giới thiệu

**3. Notification:**
- Thông báo tin nhắn mới
- Thông báo đơn hàng mới
- Thông báo hệ thống

### 2.7.6. RTMP cho Livestream

#### 2.7.6.1. Khái niệm

RTMP (Real-Time Messaging Protocol) là giao thức được phát triển bởi Adobe để truyền tải audio, video và dữ liệu qua Internet. RTMP được sử dụng rộng rãi cho livestreaming do độ trễ thấp và chất lượng tốt.

**Đặc điểm:**
- Độ trễ thấp (low latency)
- Hỗ trợ adaptive bitrate
- Tích hợp tốt với Flash và các player
- Phù hợp cho livestreaming

#### 2.7.6.2. Ứng dụng trong hệ thống

Trong hệ thống "Chợ Việt", RTMP được sử dụng để:

**1. Phát sóng livestream:**
- Streamer phát video qua RTMP
- Server nhận và xử lý stream
- Phân phối đến người xem qua CDN

**2. Tích hợp với player:**
- Sử dụng video player hỗ trợ RTMP
- Hiển thị livestream trên web
- Điều khiển play/pause, volume

**3. Recording:**
- Ghi lại livestream để xem lại sau
- Lưu trữ trên server
- Cho phép người xem xem lại

---

## 2.8. Công nghệ mới: Real-time Chatbox và Livestream

### 2.8.1. Real-time Chatbox

#### 2.8.1.1. Kiến trúc hệ thống

Hệ thống chat real-time trong "Chợ Việt" sử dụng kiến trúc hybrid kết hợp WebSocket và REST API:

**1. WebSocket Server (Node.js):**
- Xử lý tin nhắn real-time
- Quản lý kết nối client
- Broadcast tin nhắn đến người nhận
- Xác thực người dùng qua HMAC

**2. REST API (PHP):**
- Lưu trữ tin nhắn vào database
- Lấy lịch sử tin nhắn
- Quản lý file đính kèm

**3. Database (MySQL):**
- Lưu trữ tin nhắn vĩnh viễn
- Đảm bảo tính nhất quán
- Hỗ trợ truy vấn lịch sử

**4. File Storage:**
- Lưu trữ tin nhắn dạng JSON
- Backup dữ liệu
- Đồng bộ với database

#### 2.8.1.2. Quy trình hoạt động

**Gửi tin nhắn:**
```
1. Client gửi tin nhắn qua WebSocket
2. WebSocket server nhận và validate
3. Lưu vào file JSON (real-time)
4. Gửi đến người nhận nếu đang online
5. Gọi REST API để lưu vào database
6. Trả về confirmation cho người gửi
```

**Nhận tin nhắn:**
```
1. WebSocket server nhận tin nhắn
2. Kiểm tra người nhận có online không
3. Nếu online: Gửi qua WebSocket
4. Nếu offline: Lưu vào database, thông báo sau
5. Client nhận và hiển thị tin nhắn
```

#### 2.8.1.3. Tính năng bảo mật

**1. Xác thực người dùng:**
```javascript
// HMAC authentication
const crypto = require('crypto');
const userId = data.user_id;
const timestamp = Date.now();
const signature = crypto
    .createHmac('sha256', secret)
    .update(userId + ':' + timestamp)
    .digest('hex');
```

**2. CSRF Protection:**
- Validate CSRF token cho POST requests
- Sử dụng Security helper class
- Token có thời gian hết hạn

**3. Input Validation:**
- Sanitize nội dung tin nhắn
- Kiểm tra độ dài tin nhắn
- Validate user IDs

**4. Rate Limiting:**
- Giới hạn số tin nhắn trong khoảng thời gian
- Ngăn chặn spam
- Bảo vệ server

#### 2.8.1.4. Tối ưu hiệu năng

**1. Connection Pooling:**
- Quản lý kết nối WebSocket hiệu quả
- Tái sử dụng kết nối
- Giảm overhead

**2. Message Queue:**
- Xử lý tin nhắn bất đồng bộ
- Tránh block server
- Đảm bảo tin nhắn không bị mất

**3. Caching:**
- Cache danh sách cuộc trò chuyện
- Cache thông tin người dùng
- Giảm truy vấn database

**4. Load Balancing:**
- Phân tải kết nối WebSocket
- Đảm bảo hiệu năng khi có nhiều người dùng
- Failover khi server lỗi

### 2.8.2. Livestream Technology

#### 2.8.2.1. Kiến trúc livestream

Hệ thống livestream trong "Chợ Việt" bao gồm:

**1. Streaming Server:**
- Nhận stream từ streamer (RTMP)
- Xử lý và encode video
- Phân phối đến người xem

**2. CDN (Content Delivery Network):**
- Phân phối stream đến người xem gần nhất
- Giảm độ trễ
- Tăng chất lượng phát sóng

**3. WebSocket Server:**
- Cập nhật số lượng người xem real-time
- Broadcast tin nhắn trong livestream
- Cập nhật sản phẩm đang được giới thiệu

**4. Database:**
- Lưu trữ thông tin livestream
- Quản lý sản phẩm trong livestream
- Lưu lịch sử livestream

#### 2.8.2.2. Quy trình livestream

**Tạo livestream:**
```
1. Doanh nghiệp tạo livestream với thông tin cơ bản
2. Thêm sản phẩm vào livestream
3. Lưu vào database với status = "chua_bat_dau"
4. Hiển thị trong danh sách livestream sắp tới
```

**Bắt đầu livestream:**
```
1. Streamer bắt đầu phát sóng qua RTMP
2. Server nhận stream và xử lý
3. Cập nhật status = "dang_phat_song"
4. Phân phối đến người xem qua CDN
5. WebSocket cập nhật số lượng người xem
```

**Trong khi livestream:**
```
1. Người xem xem livestream qua video player
2. WebSocket cập nhật số lượng người xem
3. Streamer có thể ghim sản phẩm
4. Người xem có thể mua sản phẩm trực tiếp
5. Tin nhắn được broadcast đến tất cả người xem
```

**Kết thúc livestream:**
```
1. Streamer kết thúc phát sóng
2. Cập nhật status = "da_ket_thuc"
3. Lưu thống kê livestream
4. Cho phép xem lại (nếu có recording)
```

#### 2.8.2.3. Tính năng nâng cao

**1. Product Pinning:**
- Streamer có thể ghim sản phẩm đang giới thiệu
- Sản phẩm được ghim hiển thị nổi bật
- Người xem có thể click để xem chi tiết

**2. Special Pricing:**
- Giá đặc biệt cho sản phẩm trong livestream
- Khuyến mãi chỉ trong thời gian livestream
- Tạo cảm giác cấp bách

**3. Stock Management:**
- Quản lý số lượng tồn kho cho từng sản phẩm
- Cập nhật real-time khi có đơn hàng
- Thông báo khi hết hàng

**4. Analytics:**
- Số lượng người xem
- Số lượng sản phẩm bán được
- Doanh thu từ livestream
- Thời gian xem trung bình

#### 2.8.2.4. Tối ưu hóa

**1. Adaptive Bitrate:**
- Tự động điều chỉnh chất lượng theo bandwidth
- Đảm bảo trải nghiệm tốt cho mọi người xem
- Giảm buffering

**2. Multi-resolution:**
- Hỗ trợ nhiều độ phân giải
- Người xem chọn chất lượng phù hợp
- Tối ưu bandwidth

**3. Caching:**
- Cache stream segments
- Giảm tải cho server
- Tăng tốc độ phát sóng

**4. Monitoring:**
- Theo dõi chất lượng stream
- Phát hiện lỗi kịp thời
- Tự động xử lý sự cố

---

## Tài liệu tham khảo

[1] OECD (2000). "Measuring the Information Economy". Organisation for Economic Co-operation and Development.

[2] Statista (2023). "Live Commerce Market Size Worldwide". Statista Research Department.

[3] BrightLocal (2020). "Local Consumer Review Survey". BrightLocal Research.

---

**Kết thúc Chương 2**

